## 实验一：针对全数据集预测结果的评估指标：

## 

### 1、利用数据构图、嵌入、推荐、评估

思路：将数据划分为8：2，8用来训练并推荐，2用来和推荐进行对比。

时间片划分如下：

```python
timeSlot0 = []  # 22-7  	凌晨
timeSlot1 = []  # 7-9		早高峰
timeSlot2 = []  # 9-12		早班时间
timeSlot3 = []  # 12-14		午高峰
timeSlot4 = []  # 14-17		午班时间
timeSlot5 = []  # 17-19		晚高峰
timeSlot6 = []  # 19-22		
```

补充，node2Vec的嵌入使用的p=0.5，q=1

#### 2、一月份timeSlot1（按照频率计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 49.6832
Finished training Time used = 271.7268

Hit@ 1 : 0.041633935585231735
PrecisionScore@ 1 : 0.041633935585231735
RecallScore@ 1 : 0.041633935585231735
F1Score@ 1 : 0.041633935585231735
NDCG@ 1 : 0.041633935585231735
MAP@ 1 : 0.041633935585231735
    
Hit@ 3 : 0.1866980885048442
PrecisionScore@ 3 : 0.0700881557126651
RecallScore@ 3 : 0.0706554944575372
F1Score@ 3 : 0.07037068161166188
NDCG@ 3 : 0.07487307329332682
MAP@ 3 : 0.05073317622414253
    
Hit@ 5 : 0.29588897617177273
PrecisionScore@ 5 : 0.0780308981408735
RecallScore@ 5 : 0.07992930086409944
F1Score@ 5 : 0.07896869177787529
NDCG@ 5 : 0.08609365212040192
MAP@ 5 : 0.04851771842541648    
    
Hit@ 10 : 0.45011783189316573
PrecisionScore@ 10 : 0.08106834249803607
RecallScore@ 10 : 0.08751304047847623
F1Score@ 10 : 0.08416750430315376
NDCG@ 10 : 0.09617995315273571
MAP@ 10 : 0.04340466692772364
```

#### 8、一月份timeSlot1（按照复杂公式计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 49.6832
Finished training Time used = 271.7268

TotalRecCount=4291	
ValidRecCount=3819

Hit@ 1 : 0.007331762241424456
PrecisionScore@ 1 : 0.007331762241424456
RecallScore@ 1 : 0.007331762241424456
F1Score@ 1 : 0.007331762241424456
NDCG@ 1 : 0.007331762241424456
MAP@ 1 : 0.007331762241424456
    
Hit@ 3 : 0.07227022780832679
PrecisionScore@ 3 : 0.02505018765820015
RecallScore@ 3 : 0.025399319193506076
F1Score@ 3 : 0.0252235453582569
NDCG@ 3 : 0.025442651333250778
MAP@ 3 : 0.016096418492333675

Hit@ 5 : 0.14270751505629747
PrecisionScore@ 5 : 0.03147420790782955
RecallScore@ 5 : 0.03315876756568063
F1Score@ 5 : 0.03229453500117337
NDCG@ 5 : 0.032538812641667955
MAP@ 5 : 0.016139841727037373

Hit@ 10 : 0.31657501963864887
PrecisionScore@ 10 : 0.043047918303220085
RecallScore@ 10 : 0.049579795259291945
F1Score@ 10 : 0.046083550888298457
NDCG@ 10 : 0.04602911055642106
MAP@ 10 : 0.016836346728716034
```

#### 9、二月份timeSlot1（按照频率计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 50.7660
Finished training Time used = 287.9962

Hit@ 1 : 0.05295369877594465
PrecisionScore@ 1 : 0.05295369877594465
RecallScore@ 1 : 0.05295369877594465
F1Score@ 1 : 0.05295369877594465
NDCG@ 1 : 0.05295369877594465
MAP@ 1 : 0.05295369877594465

Hit@ 3 : 0.22591804151144226
PrecisionScore@ 3 : 0.0866595706936312
RecallScore@ 3 : 0.0872804683342202
F1Score@ 3 : 0.0869689113335371
NDCG@ 3 : 0.0918585566874195
MAP@ 3 : 0.06247412926497554

Hit@ 5 : 0.3246407663650878
PrecisionScore@ 5 : 0.09004789781798701
RecallScore@ 5 : 0.09245609366684282
F1Score@ 5 : 0.0912361073029368
NDCG@ 5 : 0.10085313378210205
MAP@ 5 : 0.058347525279403546

Hit@ 10 : 0.4773815859499734
PrecisionScore@ 10 : 0.08927621075039956
RecallScore@ 10 : 0.09774787331998624
F1Score@ 10 : 0.09332017084638408
NDCG@ 10 : 0.10871889071262472
MAP@ 10 : 0.05047615100383471
```

#### 10、二月份timeSlot1（按照复杂公式计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 23.546379
Finished training Time used = 258.33599

Hit@ 1 : 0.008781266631186802
PrecisionScore@ 1 : 0.008781266631186802
RecallScore@ 1 : 0.008781266631186802
F1Score@ 1 : 0.008781266631186802
NDCG@ 1 : 0.008781266631186802
MAP@ 1 : 0.008781266631186802


Hit@ 3 : 0.07424161788185205
PrecisionScore@ 3 : 0.025456803264147537
RecallScore@ 3 : 0.02598900124179523
F1Score@ 3 : 0.025720149504811135
NDCG@ 3 : 0.02555043396637629
MAP@ 3 : 0.015914197859381495

Hit@ 5 : 0.14129856306546035
PrecisionScore@ 5 : 0.031027142096860298
RecallScore@ 5 : 0.03244633670392077
F1Score@ 5 : 0.03172087361383871
NDCG@ 5 : 0.03222621974553625
MAP@ 5 : 0.016032981491337042

Hit@ 10 : 0.3038850452368281
PrecisionScore@ 10 : 0.040367216604576456
RecallScore@ 10 : 0.04675528185373806
F1Score@ 10 : 0.043327053824126084
NDCG@ 10 : 0.0435585365008648
MAP@ 10 : 0.015949322934286785
```

#### 3、一月份timeSlot2（按照频率计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 52.8945
Finished training Time used = 795.01554

TotalRecCount=4339
ValidRecCount=3986

Hit@ 1 : 0.04616156547917712
PrecisionScore@ 1 : 0.04616156547917712
RecallScore@ 1 : 0.04616156547917712
F1Score@ 1 : 0.04616156547917712
NDCG@ 1 : 0.04616156547917712
MAP@ 1 : 0.04616156547917712

Hit@ 3 : 0.2227797290516809
PrecisionScore@ 3 : 0.0846295367118243
RecallScore@ 3 : 0.08500585382170892
F1Score@ 3 : 0.08481727785809161
NDCG@ 3 : 0.09091558870034665
MAP@ 3 : 0.061945977588225475
    
Hit@ 5 : 0.32940291018564977
PrecisionScore@ 5 : 0.09061716006020906
RecallScore@ 5 : 0.09152868372637399
F1Score@ 5 : 0.0910706410962755
NDCG@ 5 : 0.10141503063207646
MAP@ 5 : 0.05846197803423062

Hit@ 10 : 0.4713998996487707
PrecisionScore@ 10 : 0.09290015052684442
RecallScore@ 10 : 0.09497646524741378
F1Score@ 10 : 0.09392683471149975
NDCG@ 10 : 0.1097942698042236
MAP@ 10 : 0.05117319932563158
```

#### 4、一月份timeSlot3（按照频率计算权重）

```python
#使用Word2Vec训练
Obtaining Vector Time Used = 52.6448
Finished training Time used = 494.0266

TotalRecCount=4318
ValidRecCount=3904
  
Hit@ 1 : 0.03944672131147541
PrecisionScore@ 1 : 0.03944672131147541
RecallScore@ 1 : 0.03944672131147541
F1Score@ 1 : 0.03944672131147541
NDCG@ 1 : 0.03944672131147541
MAP@ 1 : 0.03944672131147541

Hit@ 3 : 0.21311475409836064
PrecisionScore@ 3 : 0.08196721311475387
RecallScore@ 3 : 0.0825221994535517
F1Score@ 3 : 0.08224377002378368
NDCG@ 3 : 0.0871821802689648
MAP@ 3 : 0.059717953096539225

Hit@ 5 : 0.32940573770491804
PrecisionScore@ 5 : 0.08970286885245755
RecallScore@ 5 : 0.09050119535518981
F1Score@ 5 : 0.090100263760785
NDCG@ 5 : 0.09875550129466125
MAP@ 5 : 0.05674906079234947

Hit@ 10 : 0.4707991803278688
PrecisionScore@ 10 : 0.08908811475409875
RecallScore@ 10 : 0.09158026769450968
F1Score@ 10 : 0.09031700275393041
NDCG@ 10 : 0.1042105628456157
MAP@ 10 : 0.04787533351132647
    
```

## 实验二：针对Top15%数据集预测结果的自定义评估指标：

### 1、出租车群体划分：

实现了三个划分（按照driver）：

1、按照接载客数量划分Top/Bottom15%driver

2、按照实际收入划分Top/Bottom15%driver

3、划分网格收入高低

### 2、划分后如何对比：

##### 1、确定平均驾驶速度（7.5mph）依据如下

![image-20210206144220581](C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210206144220581.png)

##### 2、计价公式：

每单费用=distance×0.5+5.3，依据如下：



![image-20210206140720629](C:%5CUsers%5Clenovo%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210206140720629.png)

#### 2、问题：如何反向对比？

##### 对比方案1：

1、从2月份所有接载记录在7点-9点之间的行驶记录选出TOP15%数据为D1，Bottom15%的数据为D2.

2、将数据D1输入模型，得到基于不同的起点推荐n次（A--->[H,K,E]）,（C--->[R,Y,E]），从中找出bottom15司机的出发记录，并假设这些记录都选择推荐列表的首选地点，分别计算收入并求和**<u>S1</u>**.

3、从D2中挑选以推荐为起点的真实记录，计算所有对应收入并求和**<u>S2</u>**。

4、对比S1，S2，说明本模型带来收入提升

结果：

```
代码构建完毕，暂时没有出结果
```



##### 对比方案2：

1、D1，D2同上

2、将D1推荐n次，每次都计算收入，并求和。直到D1的行驶时间累计和等于D2出租车的行驶时间，得到S1

3、记录D2真实收入S2，对比S1，S2

结果：

```
代码构建完毕，暂时没有出结果
```



